<!DOCTYPE html>
<html>
<head>
     <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="js/jquery.mobile-1.4.2/jquery.mobile-1.4.2.css" />
   <script   src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
    <script src="js/jquery.mobile-1.4.2/jquery.mobile-1.4.2.js" type="text/javascript"></script>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBKN_QbuuqENKBxjanKrOGXMym1hI5Z2nw"></script>

    <script>
    // Within the bracket, choose a selector - a DOM object, in this case, it is the entire document.This waits for the document to load - an event listener. The function is the event handler.
    $(document).ready(function() {
        
        $("#bthnGetWeather").on("click", function() {
                                
            var weatherLocation = $("#weatherSearch").val();
         
        if (weatherLocation != ""){
            //call the function getWeatherData to get weather
           getWeatherData(weatherLocation);
           
            
        } else {
            
           alert("Enter a valid Location");
        }
                                
        });
      
        getLocation();
        
    });
    
    // This function makes a call to the api
    function getWeatherData(city){
        var apiKey = "7a2a6d2d24f1f854d75d30e12cfe583a";
        var wsUrl = "http://api.openweathermap.org/data/2.5/weather/?q=";
        wsUrl = wsUrl + "city=" + city + "&appid="+ apiKey;
        
        // Test it
        console.log(wsUrl);
        
        
        $.getJSON(wsUrl, function(data){
            console.log(data);
            var wr = "Humitidity: " + data.main.humidity + "<br>";
            wr += "Temp: " + data.main.temp;
            $("#weather").html(wr);
            initMap(data.coord.lat, data.coord.lon);
            
            
            if (data.weather[0].main == "Clouds") {
                wr += "<img src='images/clouds-icon.png'>";
            }
            else if (data.weather[0].main == "Rain") {
                wr += "<img src='images/rain-icon.png'>";
            }

            
            
            
            // Print out only the main property from the Object
            console.log(data.main);
        });
    }
    
  
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            console.log("Geolocation is not supported by this browser.");
        }
    }

    function showPosition(position) {
        console.log("Latitude: " + position.coords.latitude);
        console.log("Longitude: " + position.coords.longitude); 
    }
        
    function initMap(lat, lon) {
        
        var coords = {};
       
        
        coords.lat = parseFloat(sessionStorage.getItem("latitude"));
        coords.lon = parseFloat(sessionStorage.getItem("longitude"));
        
        var map = new google.maps.Map(document.getElementById('googleMap'), {zoom: 7, center: coords});
        
        var marker = new google.maps.Marker( {
            position: coords,
            map: map
            
        });
    }
        
    function initializeGoogleMap(lat, lon) {
        
        var mapProp = {
            center:new google.maps.LatLng(lat, lon),
            zoom: 7,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        
        var mapContainer = document.getElementById("googleMap");
        var map =
            new google.maps.Map(
                mapContainer, mapProp);
        
        

    }

    </script>
</head>
<body>
    <input type="text" id="weatherSearch" value="" />
    <input type="button" id="btnGetWeather" value="Get Weather" />
    <div id="weather">
    </div>
    <!-- change this to scale. -->
    <div id="googleMap" style="width:500px;height:380px;"></div>
</body>
</html>
